#!/usr/bin/perl -W

# usage: inflate-gzip.pl < input.txt > output.json.gz
#        gunzip output.gz

while (!eof STDIN) {
  my $c = getc STDIN;
  if ($c eq '[') {
    my $code;
    do {
      $c = getc STDIN;
      $code .= $c;
    } while ($c ne ']');
    chop $code;

    if ($code eq '\\n') {
      print chr 10;
      next;
    } else {
      if ($code eq '\\r') {
	print chr 13;
	next;
      }
    }

    print chr hex $code;

  } else {
    print $c;
  }
}

__END__

# usage: inflate-gzip.pl < input.txt > output.gz
# note : mettre dans un fichier input.txt le contenu suivant : [0x1f][0x8b][0x8][0x0][0x0][0x0][0x0][0x0][0x0][0x3]U[0x90][0xcb]n[0xc2]0[0x10]E%[0xf2][0x9a] [0xe7][0xe5][0x7][0xab].[0xda]J]T[0xea][0x1f][0xa0]a<[0x1]KN[0x82]l[0x83][0x8a][0x10][0xff][0xde]1-[0xad][0xba][0xf4][0x99]s[0xe7][0xe1][0xab]H[0xa7][0x9d][0xd8][0x8]m[0x86][0xb6][0x1b]p[0x0]%[0xc9][0xec][0xa4]R[0x1a][0xfb]N[0xb5]R[0xb6][0xd2][0x8e][0xd8][0x3]I[0xa9][0x9d]%[0xa3][0x1d][0x9a][0x16][0x14]v[0xda]([0x94][0xae]34:[0xab]@[0x9f][0x1b][0xb1][0x12]{[0x9a][0x1d]E[0xee]6A ~[0xef]|[0xcc][0x7][0x7][0x99][0x18]5[0xd6]4[0xb5][0xec][0xeb][0xb6][0x88][0xf7][0x2].[0xa7]9[0xc7][0xb][0xd7][0xac]m[0xa4]|[0xe0]c[0x0],[0x81][0xde][0xf2][0xc8][0xd2][0xd4][0x9f]i[0xde][0xce]0[0x15][0xf8][0x12]=2[0x1b]a[0xf2][0xe1][0xf2][0x80][0xef][0x14][0xd1][0xf3][0xdc][0x95][0xa0][0x9]|`B[0xac][0xad][0xa7]o[0xfc]4F[0x98][0x91][0xd6]c[0x11][0xc0][0xb9]H)[0x89][0xcd]U[0x8c]K[0x9c] gr[0xec][0xb7][0xaa][0x8a]'[0xaa][0x9e])[0x81][0xff]\Uz[0x90][0xcd]P}@[0xf4][0x89]3)G[0xa2][0xbc][0xfd][0x8d][0xfe][0xb7]Y[0x8][0xb]B[0xf0][0xb9]\[0xf2][0xc8]D[0xda][0xfb]ef[0xf0][0x16][0xa8]vT[0xbf][0xde]w[0xe0][0xc2]qI[0x19][0xc2][0x16][0x17]W6[0xbf][0xf]b[0xfa][0xf7][0x15]?[0xe2][0xed][0xf6][0x5][0x90][0xfa]7[0xc1][0x99][0x1][0x0][0x0][\r][\n]

# récupération du contenu JSON compressé gzip à partir d'une trace de ce type :

# DEBUG: org.apache.http.wire - http-outgoing-3 >> "GET /api/v1/userinfo HTTP/1.1[\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 >> "Authorization: Bearer fec14841839e3ffd4ad48810b9d336d7f652b158fc39259ace3cea800b031b20[\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 >> "Accept: text/plain, application/json, application/*+json, */*[\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 >> "Host: fcp.integ01.dev-franceconnect.fr[\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 >> "Connection: Keep-Alive[\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 >> "User-Agent: Apache-HttpClient/4.5.2 (Java/1.8.0_77)[\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 >> "Accept-Encoding: gzip,deflate[\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 >> "[\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 << "HTTP/1.1 200 OK[\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 << "Server: nginx[\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 << "Date: Sun, 17 Jul 2016 15:40:30 GMT[\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 << "Content-Type: application/json; charset=utf-8[\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 << "Transfer-Encoding: chunked[\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 << "Connection: keep-alive[\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 << "Vary: Accept-Encoding[\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 << "Vary: Accept-Encoding[\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 << "Strict-Transport-Security: max-age=15768000[\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 << "Content-Encoding: gzip[\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 << "[\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 << "11c[\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 << "[0x1f][0x8b][0x8][0x0][0x0][0x0][0x0][0x0][0x0][0x3]U[0x90][0xcb]n[0xc2]0[0x10]E%[0xf2][0x9a] [0xe7][0xe5][0x7][0xab].[0xda]J]T[0xea][0x1f][0xa0]a<[0x1]KN[0x82]l[0x83][0x8a][0x10][0xff][0xde]1-[0xad][0xba][0xf4][0x99]s[0xe7][0xe1][0xab]H[0xa7][0x9d][0xd8][0x8]m[0x86][0xb6][0x1b]p[0x0]%[0xc9][0xec][0xa4]R[0x1a][0xfb]N[0xb5]R[0xb6][0xd2][0x8e][0xd8][0x3]I[0xa9][0x9d]%[0xa3][0x1d][0x9a][0x16][0x14]v[0xda]([0x94][0xae]34:[0xab]@[0x9f][0x1b][0xb1][0x12]{[0x9a][0x1d]E[0xee]6A ~[0xef]|[0xcc][0x7][0x7][0x99][0x18]5[0xd6]4[0xb5][0xec][0xeb][0xb6][0x88][0xf7][0x2].[0xa7]9[0xc7][0xb][0xd7][0xac]m[0xa4]|[0xe0]c[0x0],[0x81][0xde][0xf2][0xc8][0xd2][0xd4][0x9f]i[0xde][0xce]0[0x15][0xf8][0x12]=2[0x1b]a[0xf2][0xe1][0xf2][0x80][0xef][0x14][0xd1][0xf3][0xdc][0x95][0xa0][0x9]|`B[0xac][0xad][0xa7]o[0xfc]4F[0x98][0x91][0xd6]c[0x11][0xc0][0xb9]H)[0x89][0xcd]U[0x8c]K[0x9c] gr[0xec][0xb7][0xaa][0x8a]'[0xaa][0x9e])[0x81][0xff]\Uz[0x90][0xcd]P}@[0xf4][0x89]3)G[0xa2][0xbc][0xfd][0x8d][0xfe][0xb7]Y[0x8][0xb]B[0xf0][0xb9]\[0xf2][0xc8]D[0xda][0xfb]ef[0xf0][0x16][0xa8]vT[0xbf][0xde]w[0xe0][0xc2]qI[0x19][0xc2][0x16][0x17]W6[0xbf][0xf]b[0xfa][0xf7][0x15]?[0xe2][0xed][0xf6][0x5][0x90][0xfa]7[0xc1][0x99][0x1][0x0][0x0][\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 << "0[\r][\n]"
# DEBUG: org.apache.http.wire - http-outgoing-3 << "[\r][\n]"

